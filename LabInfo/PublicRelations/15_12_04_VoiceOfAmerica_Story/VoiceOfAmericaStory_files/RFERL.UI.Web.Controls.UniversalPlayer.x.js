Type.registerNamespace("RFERL.UI.Web.Controls");typeof RFERL.UI.Web.Controls.UniversalPlayerBehavior=="undefined"&&(RFERL.UI.Web.Controls.UniversalPlayerBehavior=function(n){RFERL.UI.Web.Controls.UniversalPlayerBehavior.initializeBase(this,[n]);this._canChangeMedia=!1;this._hasSpecialFlash=!1;this._onCannotPlay5Handler=null;this.flashPlayTimer=null;this.flashCallBlocked=!1;this.flashCallBlockTimer=null;this._windowsMediaPlayerHeight=null},RFERL.UI.Web.Controls.UniversalPlayerBehavior.prototype={initialize:function(){RFERL.UI.Web.Controls.UniversalPlayerBehavior.callBaseMethod(this,"initialize");this.get_canChangeMedia()&&this._verifyPlayers()},dispose:function(){if(this._onCannotPlay5Handler!=null)try{this.get_player5().remove_cannotPlay(this._onCannotPlay5Handler)}catch(n){}RFERL.UI.Web.Controls.UniversalPlayerBehavior.callBaseMethod(this,"dispose")},get_canChangeMedia:function(){return this._canChangeMedia},set_canChangeMedia:function(n){n!==this._canChangeMedia&&(this._canChangeMedia=n,this.raisePropertyChanged("canChangeMedia"))},get_hasSpecialFlash:function(){return this._hasSpecialFlash},set_hasSpecialFlash:function(n){n!==this._hasSpecialFlash&&(this._hasSpecialFlash=n,this.raisePropertyChanged("hasSpecialFlash"))},get_nativeMimes:function(){return this._nativeMimes},set_nativeMimes:function(n){n!==this._nativeMimes&&(this._nativeMimes=n,this.raisePropertyChanged("nativeMimes"))},get_windowsMediaPlayerHeight:function(){return this._windowsMediaPlayerHeight},set_windowsMediaPlayerHeight:function(n){n!==this._windowsMediaPlayerHeight&&(this._windowsMediaPlayerHeight=n,this.raisePropertyChanged("windowsMediaPlayerHeight"))},get_players:function(){return $(this.get_element()).children(".j_player, .j_universal_alternate")},get_sources:function(){return $(this.get_element()).children(".j_player.j_html5 video > source, .j_player.j_html5 audio > source")},get_player5:function(){return $(this.get_element()).children(".j_player.j_html5 video, .j_player.j_html5 audio").aspNetControl(RFERL.UI.Web.Controls.Html5MediaPlayerBehavior)},_getPlayerType:function(n){if(n=$(n),n.length==0)return null;if(n.length>1)throw Error.argument("el","jQuery object must contain just one element");return n.hasClass("j_html5")?RFERL.UI.Web.Controls.PlayerType.Html5:n.hasClass("j_flash")?RFERL.UI.Web.Controls.PlayerType.Flash:n.hasClass("j_wmp")?RFERL.UI.Web.Controls.PlayerType.Wmp:n.hasClass("j_universal_alternate")?RFERL.UI.Web.Controls.PlayerType.Alternate:RFERL.UI.Web.Controls.PlayerType.unknown},_testIfPlayerIsvalid:function(n){var u=this._getPlayerType(n),f,i,r,e,t;if(u===null||u===RFERL.UI.Web.Controls.PlayerType.unknown)return!1;f=this;switch(u){case RFERL.UI.Web.Controls.PlayerType.Html5:return(i=$(n).find("video:first, audio:first").first(),i.length==0)?!1:typeof i.get(0).canPlay=="undefined"?!1:(t=!1,this.get_sources().each(function(){var n=i.get(0).canPlay($(this).attr("type"));if(n=="maybe"||n=="probably")return t=!0,!1}),t);case RFERL.UI.Web.Controls.PlayerType.Flash:if($(n).get(0).tagName.toLowerCase()!="object"&&$(n).get(0).tagName.toLowerCase()!="embed")return!1;r=!1;try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");e&&(r=!0)}catch(o){navigator.mimeTypes["application/x-shockwave-flash"]!=undefined&&(r=!0)}return r?!0:(t=!1,this.get_sources().each(function(){if(f.get_nativeMimes().indexOf($(this).attr("type"))>=0)return t=!0,!1}),t);case RFERL.UI.Web.Controls.PlayerType.Wmp:return(typeof wmp.object=="undefined"||typeof wmp.object.Volume=="undefined")&&(typeof wmp.settings=="undefined"||typeof wmp.settings.volume=="undefined")?!1:(t=!1,this.get_sources().each(function(){if($(this).attr("type")=="video/x-ms-wmv"||$(this).attr("type")=="audio/x-ms-wma")return t=!0,!1}),t);case RFERL.UI.Web.Controls.PlayerType.Alternate:return!0}return!1},_verifyPlayers:function(){if(!this.get_canChangeMedia())throw Error.invalidOperation("Players can be only validated in mode that allows changing media");var t=this,n=!1;this.get_players().each(function(){n=t._validWalker(n,this)})},_validWalker:function(n,t){return n||!This._testIfPlayerIsvalid(t)?($(t).hide(),n):($(t).show(),this._getPlayerType(t)==RFERL.UI.Web.Controls.PlayerType.Html5&&this._onCannotPlay5Handler==null&&this.get_player5().add_cannotPlay(this._onCannotPlay5Handler=Function.createDelegate(this,this._onCannotPlay5)),!0)},_onCannotPlay5:function(){var n=!1,t=!1,i=this;this.get_players().each(function(){i._getPlayerType(this)==RFERL.UI.Web.Controls.PlayerType.Html5?(n=!0,$(this).hide()):n&&(t=i._validWalker(t,this))})},setAndPlay:function(n,t){var i=this.get_element(),f=$("audio, video",i),r=this._getFlashPlayer(i),u=$("object[type='audio/x-ms-wma']",i);f.length>0&&(n.oPlayer=$(".html5Player",i),Html5PlayerSetAndPlay(n,t));r.length>0&&((n.platform&28)!=0?(r.show(),u.hide(),this.playItemInFlash(n,r.get(0),t)):(n.platform&1)==1&&(u.length===0&&(u=$("<object>").attr("id",$(i).attr("id")+"_wmpgenerated").attr("width",r.width()).attr("height",parseInt(this.get_windowsMediaPlayerHeight())>0?parseInt(this.get_windowsMediaPlayerHeight()):r.height()).attr("type","audio/x-ms-wma").attr("data",n.wmaUrl).append($("<param>").attr("name","src").attr("value",n.wmaUrl),$("<param>").attr("name","controller").attr("value","true"),$("<param>").attr("name","autostart").attr("value","false")),$(i).append(u)),r.hide(),u.show(),this.playItemInWMP(n,u.get(0),t)))},stop:function(){var t=this.get_element(),i=$("audio, video",t),n=this._getFlashPlayer(t);i.length>0&&i.trigger("pause");n.length>0&&n.get(0).jsStop&&n.get(0).jsStop()},_getFlashPlayer:function(n){return $("object",n).not(function(){return $(this).parents("audio, video").length>0?!0:!1})},playItemInFlash:function(n,t,i){(n.platform&28)!=0&&window.clearTimeout(this.flashPlayTimer);this._playItemInFlash(n,t,i)},_playItemInFlash:function(n,t,i){var r=this;t.playMedia&&!this.flashCallBlocked?t.playMedia(n.flashXmlUrl)==="error"?this.flashPlayTimer=window.setTimeout(function(){r._playItemInFlash(n,t,i)},500):(this.flashCallBlocked=!0,window.setTimeout(function(){r.flashCallBlocked=!1},900),i&&i()):(window.clearTimeout(this.flashCallBlockTimer),this.flashCallBlockTimer=window.setTimeout(function(){r._playItemInFlash(n,t,i)},900))},playItemInWMP:function(n,t,i){var r=this;try{if(typeof t.controls=="undefined"){window.setTimeout(function(){r.playItemInWMP(n,t,i)},900);return}if(t.controls.stop(),t.playState==3){window.setTimeout(function(){r.playItemInWMP(n,t,i)},900);return}t.URL=n.wmaUrl;t.controls.play()}catch(u){if(typeof t.object=="undefined"){window.setTimeout(function(){r.playItemInWMP(n,t,i)},900);return}if(t.object.Stop(),t.playState==3){window.setTimeout(function(){r.playItemInWMP(n,t,i)},900);return}t.object.FileName=t.URL=n.wmaUrl;t.object.Play()}i&&i()},wmpStop:function(n){try{n.controls.stop()}catch(t){}}},RFERL.UI.Web.Controls.UniversalPlayerBehavior.registerClass("RFERL.UI.Web.Controls.UniversalPlayerBehavior",Sys.UI.Control),RFERL.UI.Web.Controls.PlayerType=function(){},RFERL.UI.Web.Controls.PlayerType.prototype={unknown:0,Html5:1,Flash:2,Wmp:3,Alternate:4},RFERL.UI.Web.Controls.PlayerType.registerEnum("RFERL.UI.Web.Controls.PlayerType"));;
Type.registerNamespace("www.rferl.org.Widgets");www.rferl.org.Widgets.QuizWidgetBehavior=function(n){www.rferl.org.Widgets.QuizWidgetBehavior.initializeBase(this,[n]);this._quizId=null;this._useBigImage=!1;this._useOneColumn=!1;this._useInArticle=!1;this._data=null;this._index=0;this._handlers=[];this._score=0;this._resultsTemplate=null;this._doNotReportResults=!1};www.rferl.org.Widgets.QuizWidgetBehavior.prototype={_radio_clickHandler:null,initialize:function(){www.rferl.org.Widgets.QuizWidgetBehavior.callBaseMethod(this,"initialize");this.$addElementHandler(this.get_resetButton(),"click",this._reset_click);this.$addElementHandler(this.get_submitButton(),"click",this._submit_click);this.$addElementHandler(this.get_nextButton(),"click",this._next_click);var n=this;this._radio_clickHandler=Function.createDelegate(this,this._radio_click);$(".j_answers .j_item:not(.j_template) .j_radio",this.get_element()).each(function(){$addHandler(this,"click",n._radio_clickHandler,!0)});this.$addElementHandler;this.set_originalTitle(this.get_title());$(this.get_ansersHolder()).find(".j_item:not(.j_template) .j_radio").attr("disabled",!1).removeClass("disabled")},dispose:function(){if(this._handlers){for(var n in this._handlers)try{$removeHandler(this._handlers[n].element,this._handlers[n].eventName,this._handlers[n].handler)}catch(t){}this._handlers=null}try{$(".j_answers .j_item:not(.j_template) .j_radio",this.get_element()).each(function(){try{$removeHandler(this,"click",This._radio_clickHandler,!0)}catch(n){}})}catch(t){}www.rferl.org.Widgets.QuizWidgetBehavior.callBaseMethod(this,"dispose")},get_quizId:function(){return this._quizId},set_quizId:function(n){n!==this._quizId&&(this._quizId=n,this.raisePropertyChanged("quizId"))},get_useOneColumn:function(){return this._useOneColumn},set_useOneColumn:function(n){n!==this._useOneColumn&&(this._useOneColumn=n,this.raisePropertyChanged("useOneColumn"))},get_useInArticle:function(){return this._useInArticle},set_useInArticle:function(n){n!==this._useInArticle&&(this._useInArticle=n,this.raisePropertyChanged("useInArticle"))},get_useBigImage:function(){return this._useBigImage},set_useBigImage:function(n){n!==this._useBigImage&&(this._useBigImage=n,this.raisePropertyChanged("useBigImage"))},get_resultsTemplate:function(){return this._resultsTemplate},set_resultsTemplate:function(n){n!==this._resultsTemplate&&(this._resultsTemplate=n,this.raisePropertyChanged("resultsTemplate"))},get_shareResultsTemplate:function(){return this._shareResultsTemplate},set_shareResultsTemplate:function(n){n!==this._resultsTemplate&&(this._shareResultsTemplate=n,this.raisePropertyChanged("shareResultsTemplate"))},get_repeatText:function(){return this._repeatText},set_repeatText:function(n){n!==this._repeatText&&(this._repeatText=n,this.raisePropertyChanged("repeatText"))},get_doNotReportResults:function(){return this._doNotReportResults},set_doNotReportResults:function(n){n!==this._doNotReportResults&&(this._doNotReportResults=n,this.raisePropertyChanged("doNotReportResults"))},get_title:function(){return $(".j_title",this.get_element()).text()},set_title:function(n){$(".j_title",this.get_element()).text(n)},get_counter:function(){return $(".j_counter",this.get_element())[0]},get_questionNumber:function(){return $(".j_qno",this.get_element()).text()},set_questionNumber:function(n){$(".j_qno",this.get_element()).text(n)},_set_questionCount:function(n){$(".j_qcount",this.get_element()).text(Sys.CultureInfo.CurrentCulture.digitsToNative(n.toLocaleString()))},get_mediaHolder:function(){return $(".j_qmediaDiv",this.get_element())[0]},get_image:function(){return $(".j_qimage",this.get_element())[0]},get_videoDiv:function(){return $(".j_qvideoDiv",this.get_element())[0]},get_imageDiv:function(){return $(".j_qimageDiv",this.get_element())[0]},get_percentageHolder:function(){return $(".j_percent",this.get_element())[0]},get_percentage:function(){return $(this.get_percentageHolder()).text()},set_percentage:function(n){$(this.get_percentageHolder()).text(n)},get_shareResultsHolder:function(){return $(".j_shareResults",this.get_element())[0]},set_shareResults:function(n){$(this.get_shareResultsHolder()).html(n)},get_questionText:function(){return $(".j_qtext",this.get_element()).html()},set_questionText:function(n){$(".j_qtext",this.get_element()).html(n)},get_ansersHolder:function(){return $(".j_answers",this.get_element())[0]},get_answerTemplate:function(){return $(".j_answers .j_item.j_template",this.get_element())[0]},get_resetButton:function(){return $(".j_reset",this.get_element())[0]},get_submitButton:function(){return $(".j_submit",this.get_element())[0]},get_nextButton:function(){return $(".j_next",this.get_element())[0]},get_afterHolder:function(){return $(".j_after",this.get_element())[0]},get_data:function(){return this._data},set_data:function(n){n!==this._data&&(this._data=n,this.raisePropertyChanged("data"))},get_index:function(){return this._index},set_index:function(n){n!==this._index&&(this._index=n,this.raisePropertyChanged("index"))},get_originalTitle:function(){return this._originalTitle},set_originalTitle:function(n){n!==this._originalTitle&&(this._originalTitle=n,this.raisePropertyChanged("originalTitle"))},$addElementHandler:function(n,t,i){var r=Function.createDelegate(this,i);$addHandler(n,t,r);this._handlers.push({element:n,eventName:t,handler:r})},getData:function(n,t){$(".j_loading",this.get_element()).show();www.rferl.org.Services.PollWidgetService.GetQuizData(this.get_quizId(),this.get_useBigImage(),this.get_useOneColumn(),this.get_useInArticle(),Function.createDelegate(this,this._getDataCallback),t,n)},initGetData:function(n,t){var i=this;this.get_data()==null?this.getData(function(){i.startQuiz();n()},t):(i.startQuiz(),n())},_wasToggled:!1,_isToggledTrue:!1,toggleVisible:function(n){this._wasToggled?this._isToggledTrue?($(n).hide(),this._isToggledTrue=!1):($(n).show(),this._isToggledTrue=!0):($(n).show(),this._isToggledTrue=this._wasToggled=!0)},_getDataCallback:function(n,t){$(".j_loading",this.get_element()).hide();this.set_data(n);t&&Object.getType(t)===Function&&t()},startQuiz:function(){this.set_index(0);$(".j_content_primary",this.get_element()).removeClass("noQuizImage");this._showQuestion();$(".j_startendfooter",this.get_element()).hide();$(".j_questionfooter",this.get_element()).show();$(".j_header",this.get_element()).show();for(i in this.get_data())this.get_data()[i].Correct=!1;this._set_questionCount(this.get_data().length)},_showQuestion:function(){var n=this.get_data()[this.get_index()],u,i,t,r;$(".j_item:not(.j_template)",this.get_ansersHolder()).remove();$(this.get_afterHolder()).hide();$(this.get_nextButton()).attr("disabled",!0).addClass("disabled");$(this.get_submitButton()).attr("disabled",!0).addClass("disabled");$(this.set_questionText(n.Text));n.Image?(this.loadMediaItem(n.VideoId,n.MediaData,n.Image),$(this.get_mediaHolder()).show()):$(this.get_mediaHolder()).hide();for(u in n.Answers)i=n.Answers[u],t=$(this.get_answerTemplate()).clone().removeClass("j_template").show(),t.find(".j_atext").html(i.Text),$(this.get_answerTemplate()).parent().append(t),$addHandler($(".j_radio",t)[0],"click",this._radio_clickHandler,!0),r=this.get_id()+"_a"+i.Id,$(".j_radio",t).attr("id",r),$(".j_atext",t).attr("for",r);this.set_questionNumber(n.Order)},_showResults:function(){var n,r,t,u,f;$(".j_questionfooter",this.get_element()).hide();$(".j_startendfooter",this.get_element()).show();n=0;for(i in this.get_data())this.get_data()[i].Correct&&n++;r=n/this.get_data().length*100;$(this.get_afterHolder()).hide();$(this.get_mediaHolder()).hide();$(this.get_ansersHolder()).hide();$(this.get_resetButton()).show();$(this.get_counter()).hide();$(this.get_percentageHolder()).show();$(this.get_shareResultsHolder()).show();t=Sys.CultureInfo.CurrentCulture.digitsToNative(String.localeFormat(window.Localizations.Widgets.Quiz.PercentageFormat,r));this.set_percentage(t);u=this.get_shareResultsTemplate().replace(/%25score%25/g,encodeURI(t)).replace(/%25correct%25/g,encodeURI(n.toNativeString(null,"d0"))).replace(/%25total%25/g,encodeURI(this.get_data().length.toNativeString(null,"d0")));this.set_shareResults(u);f=this.get_resultsTemplate().replace(/%score%/g,t).replace(/%correct%/g,n.toNativeString(null,"d0")).replace(/%total%/g,this.get_data().length.toNativeString(null,"d0"));$(this.set_questionText("<h2>"+window.Localizations.Widgets.Quiz.Results+"<\/h2>"+f));this.get_repeatText()&&$(".j_qtext",this.get_element()).append($("<p class='repeattext'>").text(this.get_repeatText()));this.get_doNotReportResults()||www.rferl.org.Services.PollWidgetService.ReportScore(this.get_quizId(),r)},_reset_click:function(){$(this.get_resetButton()).hide();this.initGetData(function(){});this.set_title(this.get_originalTitle());$(this.get_percentageHolder()).hide();$(this.get_shareResultsHolder()).hide();$(this.get_counter()).show();$(this.get_ansersHolder()).show()},_submit_click:function(){this.get_data()==null?this.getData(Function.createDelegate(this,this._submit_click_continue)):this._submit_click_continue()},_submit_click_continue:function(){var n=this.get_data()[this.get_index()],t;n.AfterAnswer&&$(this.get_afterHolder()).html(n.AfterAnswer).show();$(this.get_nextButton()).removeAttr("disabled").removeClass("disabled");$(this.get_submitButton()).attr("disabled",!0).addClass("disabled");$(this.get_ansersHolder()).find(".j_item:not(.j_template) .j_radio").attr("disabled",!0).addClass("disabled");t=!0;$(this.get_ansersHolder()).find(".j_item:not(.j_template)").each(function(i){n.Answers[i].Correct?$(".j_imgOK",this).show():$(".j_imgKO",this).show();t=t&&n.Answers[i].Correct==$(".j_radio",this).is(":checked")});n.Correct=t},_next_click:function(){this.set_index(this.get_index()+1);this.get_index()>=this.get_data().length?this._showResults():this._showQuestion()},_radio_click:function(){$(".j_answers .j_item:not(.j_template) .j_radio:checked",this.get_element()).length>0?$(this.get_submitButton()).removeAttr("disabled").removeClass("disabled"):$(this.get_submitButton()).attr("disabled",!0).addClass("disabled")},loadMediaItem:function(n,t,i){var u=this.get_element(),r=null,f=$(".mmw_video",u);$(".mmw_content_container > *",u).addClass("item_hide");f.length>0&&(r=$find($("[id*=qVideoPlayer]",u).attr("id")),r&&r.stop());f.removeClass("item_hide");n==0?($(this.get_image()).attr("src",i),$(this.get_imageDiv()).show(),$(this.get_videoDiv()).hide()):($(this.get_imageDiv()).hide(),$(this.get_videoDiv()).show(),$(this.get_image()).attr("src","/img/loading.gif"),t.contentId=n,t.flashXmlUrl="/GetFlashXml.aspx?param=%id%|user|video".replace("%id%",n),t.shareUrl="",t.platform=4,t.playMode="user",r.setAndPlay(t))}};www.rferl.org.Widgets.QuizWidgetBehavior.registerClass("www.rferl.org.Widgets.QuizWidgetBehavior",Sys.UI.Control);;